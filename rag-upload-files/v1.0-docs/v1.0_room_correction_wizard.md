# Room Correction Wizard - Complete Guide

## Overview
The Room Correction Wizard is a Roon-inspired tool for measuring and correcting room acoustics using smartphone microphones and pink noise.

## Access
- **Web Interface:** http://192.168.1.159/ (or ghettoblaster.local)
- **Location:** Audio Settings → Room Correction → Run Wizard
- **Direct URL:** http://192.168.1.159/snd-config.php

## Wizard Steps

### Step 1: Preparation
- Position smartphone at listening position
- Ensure microphone permissions are granted
- Reduce ambient noise

### Step 2: Ambient Noise Measurement
- Measures background noise (5 seconds)
- Required before main measurement
- Automatically subtracted from results

### Step 3: Continuous Measurement with Pink Noise
- Pink noise plays continuously
- Uses Web Audio API for real-time measurement
- 2-3 second rolling average
- Click "Apply Correction" when satisfied

### Step 4: Upload Measurement (Optional)
- Can upload WAV file instead of browser measurement
- Supports audio/wav format

### Step 5: Analysis & Filter Generation
- Shows frequency response graph
- Target curve selection (flat or house curve)
- Generates PEQ filter (12 bands, CamillaDSP Biquad)

### Step 6: Apply & Test
- Shows before/after comparison
- Applies filter via CamillaDSP
- A/B test available

## Technical Details

### Backend
- **File:** `moode-source/www/command/room-correction-wizard.php`
- **Commands:** start_wizard, upload_measurement, analyze_measurement, generate_peq, apply_peq, start_pink_noise, stop_pink_noise, process_frequency_response

### Frontend
- **File:** `moode-source/www/templates/snd-config.html`
- **Modal:** `#room-correction-wizard-modal`
- **Steps:** 6 steps (wizard-step-1 through wizard-step-6)

### Pink Noise
- Uses `sox` to generate continuous pink noise
- Stops MPD service to free audio device
- Uses ALSA device: `_audioout` (if CamillaDSP active) or `plughw:0,0` (direct)
- Volume controlled by system/ALSA volume

### Filter Generation
- Python script: `/usr/local/bin/generate-camilladsp-eq.py`
- Output: CamillaDSP YAML config with Biquad filters
- Location: `/usr/share/camilladsp/configs/`
- Preset naming: `room_correction_peq_YYYY-MM-DD_HH-MM-SS`

### Correction Limits
- Bass range (20-35 Hz): ±15 dB maximum
- All other frequencies: ±10 dB maximum

## Current Status
- ✅ All 6 steps implemented
- ✅ Web Audio API measurement working
- ✅ Pink noise playback working
- ✅ Filter generation working
- ✅ Auto-connect to WiFi configured

## Network Configuration
- **WiFi:** nam yang 2 (192.168.1.159)
- **Ethernet:** 192.168.2.3 (when connected)
- **Hostname:** ghettoblaster.local
- **Auto-Connect:** Enabled for WiFi

