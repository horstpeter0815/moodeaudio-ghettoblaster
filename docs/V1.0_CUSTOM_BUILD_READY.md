# ‚úÖ v1.0 Custom Build Ready

## Status: All Working Configurations Preserved

**Date:** 2026-01-15  
**moOde Version:** 10.0.3  
**Status:** Complete working system ready for custom build

---

## üéØ Why Custom Build is More Stable

### Current Setup (Updated moOde):
- ‚ùå Updates can overwrite configurations
- ‚ùå Database values can be reset
- ‚ùå ALSA/CamillaDSP configs might be replaced
- ‚ùå Requires manual reconfiguration after updates
- ‚ö†Ô∏è  Less stable - changes with each update

### Custom Build (Frozen State):
- ‚úÖ All configurations baked into image
- ‚úÖ Updates won't break customizations
- ‚úÖ Reproducible - same image every time
- ‚úÖ Faster deployment to new SD cards
- ‚úÖ More stable - no unexpected changes
- ‚úÖ Version locked - moOde 10.0.3 with all fixes

---

## üì¶ What's Included in v1.0 Custom Build

### 1. Display Configuration
- **File:** `/home/andre/.xinitrc`
- **Settings:**
  - Portrait mode rotation (HDMI-2, rotate left)
  - Screen resolution: 1280x400
  - Dynamic HDMI port detection
  - Chromium browser for WebUI
  - PeppyMeter integration

### 2. Audio ALSA Configuration
- **Files:**
  - `/etc/alsa/conf.d/_audioout.conf` - MPD output to loopback
  - `/etc/alsa/conf.d/_peppyout.conf` - PeppyMeter output to HiFiBerry
  - `/etc/alsa/conf.d/99-default.conf` - Default ALSA settings
- **Routing:**
  - MPD ‚Üí `_audioout` ‚Üí Loopback ‚Üí CamillaDSP ‚Üí `_peppyout` ‚Üí HiFiBerry AMP100

### 3. CamillaDSP Configuration
- **Files:**
  - `/usr/share/camilladsp/working_config.yml` - Active Bose Wave filters
  - `/usr/share/camilladsp/configs/bose_wave_filters.yml` - Symlink to working config
  - `/usr/share/camilladsp/__quick_convolution__.yml` - Template
- **Settings:**
  - Capture: `hw:Loopback,1,0`
  - Playback: `_peppyout`
  - Filters: 20-band Bose Wave Room EQ
  - **Cleanup:** All default/headphone filters removed

### 4. PeppyMeter Configuration
- **File:** `/etc/peppymeter/config.txt`
- **Settings:**
  - Skin: Blue
  - Resolution: 1280x400
  - Display type: Meter

### 5. System Configuration
- **File:** `/boot/firmware/config.txt`
- **Settings:**
  - `dtparam=audio=off` - Disable HDMI audio
  - `dtoverlay=vc4-kms-v3d-pi5,noaudio` - No audio overlay
- **Module:** `/etc/modules-load.d/alsa-loopback.conf`
  - `snd-aloop` - ALSA loopback module

### 6. Database Settings (Applied on First Boot)
- **File:** `/usr/local/bin/apply-v1.0-database-settings.sh`
- **Settings:**
  - `cardnum = 1`
  - `i2sdevice = HiFiBerry AMP100`
  - `adevname = HiFiBerry AMP100`
  - `alsa_output_mode = plughw`
  - `camilladsp = bose_wave_filters.yml`
  - `cdsp_fix_playback = Yes`
  - `hdmi_scn_orient = portrait`
  - `local_display = 1`
  - `peppy_display = 0`
  - `peppy_display_type = meter`
  - `volume_control = Software`
  - `mpd.device = _audioout`

---

## üöÄ Building the Custom Image

### Prerequisites
1. Docker installed and running
2. Build directory: `imgbuild/`
3. Configurations exported: `imgbuild/v1.0-config-export/`

### Build Command
```bash
cd /Users/andrevollmer/moodeaudio-cursor
./tools/build.sh --build
```

### Build Process
1. **Stage 1-2:** Base Raspberry Pi OS
2. **Stage 3:** moOde installation
3. **Stage 3 Custom:** v1.0 configurations applied
   - Display (.xinitrc)
   - ALSA configs
   - CamillaDSP (Bose Wave filters)
   - PeppyMeter config
   - System settings (config.txt, modules)
   - Database settings (first-boot script)

### After Build
1. **Validate:** `./tools/build.sh --validate`
2. **Deploy:** `./tools/build.sh --deploy`
3. **Test:** Boot new SD card and verify all configurations

---

## ‚úÖ Verification Checklist

After building and booting the custom image:

- [ ] Display: Portrait mode (1280x400) working
- [ ] Audio: HiFiBerry AMP100 detected and playing
- [ ] CamillaDSP: Bose Wave filters active
- [ ] PeppyMeter: Blue skin, 1280x400 resolution
- [ ] Web Interface: All pages loading correctly
- [ ] Database: All v1.0 settings applied
- [ ] Services: MPD, CamillaDSP, PeppyMeter, LocalDisplay all active
- [ ] No default filters: Only Bose Wave filters in CamillaDSP

---

## üìù Notes

- **Version Lock:** moOde 10.0.3 is locked in the build
- **Stability:** All configurations are frozen - no unexpected changes
- **Reproducibility:** Same image every time
- **Deployment:** Fast - just flash SD card and boot
- **Updates:** Custom build won't be affected by moOde updates

---

## üîß Maintenance

If you need to update the custom build:
1. Make changes on running system
2. Export new configurations: `v1.0-config-export/`
3. Copy to build directory: `imgbuild/v1.0-config-export/`
4. Rebuild image

---

**Status:** ‚úÖ Ready for custom build  
**Recommendation:** Create custom build to preserve this exact working state
