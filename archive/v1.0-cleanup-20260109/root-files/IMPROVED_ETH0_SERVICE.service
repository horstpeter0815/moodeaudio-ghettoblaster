[Unit]
Description=ETH0 Direct Static IP - RELIABLE VERSION
DefaultDependencies=no
After=local-fs.target
Before=network-pre.target
Before=NetworkManager.service
Conflicts=shutdown.target

[Service]
Type=oneshot
RemainAfterExit=yes
StandardOutput=journal
StandardError=journal
# RELIABLE ETH0 CONFIGURATION - WITH RETRIES AND VERIFICATION
ExecStart=/bin/bash -c '
    echo "ðŸ”§ ETH0 Direct Static IP Service starting..."
    
    # Wait for eth0 interface (up to 15 seconds)
    ETH0_FOUND=false
    for i in {1..15}; do
        if ip link show eth0 >/dev/null 2>&1; then
            ETH0_FOUND=true
            echo "âœ… eth0 Interface found"
            break
        fi
        sleep 1
    done
    
    if [ "$ETH0_FOUND" = "true" ]; then
        # Configure eth0 DIRECTLY with ifconfig (works always)
        echo "ðŸ”§ Configuring eth0: 192.168.10.2/24"
        
        # Set IP address (retry up to 3 times)
        for attempt in {1..3}; do
            ifconfig eth0 192.168.10.2 netmask 255.255.255.0 up 2>/dev/null || true
            sleep 1
            
            # Verify IP was set
            ETH0_IP=$(ip addr show eth0 2>/dev/null | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
            if [ "$ETH0_IP" = "192.168.10.2" ]; then
                echo "âœ… eth0 configured: $ETH0_IP"
                break
            else
                echo "âš ï¸  Attempt $attempt: IP not set correctly (got: $ETH0_IP)"
            fi
        done
        
        # Set default route
        route del default gw 192.168.10.1 2>/dev/null || true
        route add default gw 192.168.10.1 eth0 2>/dev/null || true
        
        # Set DNS
        echo "nameserver 192.168.10.1" > /etc/resolv.conf 2>/dev/null || true
        echo "nameserver 8.8.8.8" >> /etc/resolv.conf 2>/dev/null || true
        
        # Final verification
        ETH0_IP=$(ip addr show eth0 2>/dev/null | grep "inet " | awk "{print \$2}" | cut -d/ -f1)
        if [ "$ETH0_IP" = "192.168.10.2" ]; then
            echo "âœ…âœ…âœ… eth0 SUCCESSFULLY configured: $ETH0_IP âœ…âœ…âœ…"
        else
            echo "âŒ ERROR: eth0 IP is $ETH0_IP (should be 192.168.10.2)"
        fi
    else
        echo "âš ï¸  eth0 Interface not found - will retry later"
    fi
    
    echo "âœ… ETH0 Direct Static IP Service completed"
'

# Watchdog: Check every 10 seconds for first 2 minutes
ExecStartPost=/bin/bash -c 'for i in {1..12}; do sleep 10; ETH0_IP=$(ip addr show eth0 2>/dev/null | grep "inet " | awk "{print \$2}" | cut -d/ -f1); if [ -z "$ETH0_IP" ] || [ "$ETH0_IP" != "192.168.10.2" ]; then echo "âš ï¸  eth0 IP wrong: $ETH0_IP - fixing..."; ifconfig eth0 192.168.10.2 netmask 255.255.255.0 up 2>/dev/null || true; route add default gw 192.168.10.1 eth0 2>/dev/null || true; fi; done &'

[Install]
WantedBy=local-fs.target
WantedBy=sysinit.target

