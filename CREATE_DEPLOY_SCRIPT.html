<!DOCTYPE html>
<html>
<head>
    <title>Create Deploy Script</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .code { background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 4px; font-family: monospace; white-space: pre-wrap; overflow-x: auto; }
        .instructions { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
        button { padding: 10px 20px; background: #d32f2f; color: white; border: none; cursor: pointer; font-size: 16px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Create Deployment Script</h1>
    <div class="instructions">
        <p><strong>Anleitung:</strong></p>
        <ol>
            <li>Öffne die Browser-Konsole (F12 oder Cmd+Option+I)</li>
            <li>Kopiere den JavaScript-Code unten</li>
            <li>Füge ihn in die Konsole ein und drücke Enter</li>
            <li>Das Script wird versuchen, die Datei <code>deploy.php</code> zu erstellen</li>
        </ol>
    </div>
    
    <h2>JavaScript Code (in Browser-Konsole einfügen):</h2>
    <div class="code" id="js-code"></div>
    
    <button onclick="copyCode()">Code kopieren</button>
    <button onclick="executeCode()">Code ausführen (nur wenn auf moOde-Server)</button>
    
    <div id="result" style="margin-top: 20px;"></div>
    
    <script>
        const deployScript = `<?php
// DEPLOY NOW - Auto-created deployment script
// Access: https://10.10.11.39:8443/deploy.php

$deploy_dir = '/boot/moode_deploy';
$web_root = '/var/www/html';

header('Content-Type: text/html; charset=utf-8');
?>
<!DOCTYPE html>
<html>
<head>
    <title>Deploy Files</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        pre { background: #fff; padding: 10px; border: 1px solid #ddd; overflow-x: auto; }
        button { padding: 10px 20px; background: #d32f2f; color: white; border: none; cursor: pointer; font-size: 16px; margin: 10px 0; }
        button:hover { background: #b71c1c; }
    </style>
</head>
<body>
    <h1>moOde Deployment Tool</h1>
    <?php
    if (isset($_POST['deploy'])) {
        $results = [];
        $errors = [];
        
        // 1. Delete index.html
        if (file_exists("$web_root/index.html")) {
            if (@unlink("$web_root/index.html")) {
                $results[] = "✓ Deleted index.html";
            } else {
                $errors[] = "✗ Failed to delete index.html";
            }
        }
        
        // 2. Copy test-wizard files
        if (is_dir("$deploy_dir/test-wizard")) {
            $target = "$web_root/test-wizard";
            if (!is_dir($target)) @mkdir($target, 0755, true);
            foreach (['index-simple.html', 'wizard-functions.js', 'snd-config.html'] as $file) {
                $src = "$deploy_dir/test-wizard/$file";
                $dst = "$target/$file";
                if (file_exists($src) && @copy($src, $dst)) {
                    @chmod($dst, 0644);
                    $results[] = "✓ Copied test-wizard/$file";
                } else {
                    $errors[] = "✗ Failed to copy test-wizard/$file";
                }
            }
        }
        
        // 3. Copy room-correction-wizard.php
        if (file_exists("$deploy_dir/command/room-correction-wizard.php")) {
            $target = "$web_root/command";
            if (!is_dir($target)) @mkdir($target, 0755, true);
            $src = "$deploy_dir/command/room-correction-wizard.php";
            $dst = "$target/room-correction-wizard.php";
            if (@copy($src, $dst)) {
                @chmod($dst, 0644);
                $results[] = "✓ Copied room-correction-wizard.php";
            } else {
                $errors[] = "✗ Failed to copy room-correction-wizard.php";
            }
        }
        
        echo "<h2>Results:</h2><pre>";
        foreach ($results as $r) echo $r . "\\n";
        foreach ($errors as $e) echo $e . "\\n";
        echo "</pre>";
        
        if (empty($errors)) {
            echo "<p class='success'>✓ Deployment Complete!</p>";
            echo "<p><a href='/'>Access Player</a> | <a href='/test-wizard/index-simple.html'>Access Wizard</a></p>";
        }
    } else {
        echo "<form method='POST'><button type='submit' name='deploy'>Deploy Now</button></form>";
    }
    ?>
</body>
</html>`;

        const jsCode = `
// Create deploy.php file via fetch
(async function() {
    const phpContent = \`${deployScript.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`;
    
    try {
        // Try to create file via PHP endpoint (if available)
        const response = await fetch('/command/room-correction-wizard.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'cmd=create_file&file=deploy.php&content=' + encodeURIComponent(phpContent)
        });
        
        if (response.ok) {
            console.log('✓ File created via API');
            window.location.href = '/deploy.php';
        } else {
            console.log('✗ API method failed, trying alternative...');
            // Alternative: Show content to copy manually
            alert('Bitte kopiere den PHP-Code manuell:\\n\\n1. Öffne einen Text-Editor\\n2. Erstelle deploy.php\\n3. Kopiere den Code aus der Konsole');
            console.log('PHP Code to copy:');
            console.log(phpContent);
        }
    } catch (error) {
        console.error('Error:', error);
        console.log('PHP Code to copy manually:');
        console.log(phpContent);
        alert('Bitte kopiere den PHP-Code manuell (siehe Konsole)');
    }
})();
`;

        document.getElementById('js-code').textContent = jsCode;
        
        function copyCode() {
            navigator.clipboard.writeText(jsCode).then(() => {
                alert('Code kopiert! Füge ihn in die Browser-Konsole ein.');
            });
        }
        
        function executeCode() {
            if (confirm('Möchtest du den Code jetzt ausführen? (Nur auf moOde-Server)')) {
                eval(jsCode);
            }
        }
    </script>
</body>
</html>

