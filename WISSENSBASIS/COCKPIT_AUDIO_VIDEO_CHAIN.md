# 🎛️ GRAFISCHES COCKPIT: AUDIO & VIDEO CHAIN

**Datum:** 1. Dezember 2025  
**Status:** Final  
**Version:** 1.0  
**Zweck:** Detaillierte Visualisierung der kompletten Audio- und Video-Pipeline

---

## 🎬 VIDEO CHAIN (KOMPLETT & DETAILLIERT)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    VIDEO PIPELINE                                            │
│                              Vom Source bis zum Display                                      │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  LAYER 1: APPLICATION LAYER                                                                 │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  Chromium Browser (Kiosk Mode)                                                         │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Command: chromium-browser --kiosk http://localhost/                                   │   │
│  │  Process: chromium-browser (PID: varies)                                               │   │
│  │  Display: :0                                                                           │   │
│  │  URL: http://localhost/ (Moode UI)                                                      │   │
│  │  Mode: Fullscreen (Kiosk)                                                              │   │
│  │  Status: ⚠️  Instabil (FT6236 Timing-Problem)                                          │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ X11 Protocol                                                     │
│                            ▼                                                                  │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  PeppyMeter (Alternative)                                                              │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Script: /opt/peppymeter/peppymeter.py                                                 │   │
│  │  Config: /etc/peppymeter/config.txt                                                    │   │
│  │  Resolution: 1280x400                                                                  │   │
│  │  Skin: gold                                                                            │   │
│  │  Display: :0                                                                           │   │
│  │  Status: ✅ Funktioniert (wenn X Server läuft)                                        │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ X11 Protocol                                                     │
│                            ▼                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                            │
                            │
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  LAYER 2: X11 SERVER LAYER                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  X Server (Xorg)                                                                       │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Process: /usr/lib/xorg/Xorg :0                                                        │   │
│  │  Display: :0                                                                            │   │
│  │  Version: X.Org X Server 1.21.1.16                                                     │   │
│  │  Protocol: X11 (Version 11, Revision 0)                                                │   │
│  │  Service: localdisplay.service                                                          │   │
│  │  Config: /home/andre/.xinitrc                                                           │   │
│  │  Status: ⚠️  Instabil (FT6236 Timing-Problem)                                          │   │
│  │                                                                                          │   │
│  │  Konfiguration:                                                                          │   │
│  │  - Display Rotation: Left (Landscape)                                                   │   │
│  │  - Touchscreen Calibration: 0 -1 1 1 0 0 0 0 1                                          │   │
│  │  - Output: HDMI-1                                                                        │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ X11 → DRM/KMS                                                    │
│                            ▼                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                            │
                            │
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  LAYER 3: DRM/KMS DRIVER LAYER                                                               │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  DRM/KMS Driver (vc4)                                                                 │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Kernel Module: vc4                                                                    │   │
│  │  Device: /dev/dri/card0                                                                │   │
│  │  Overlay: vc4-kms-v3d-pi5,noaudio                                                     │   │
│  │  I2C Bus: 13 (RP1 Controller) - für EDID                                              │   │
│  │  Status: ✅ Funktioniert (wenn FT6236 nicht zu früh lädt)                            │   │
│  │                                                                                          │   │
│  │  Dependencies:                                                                          │   │
│  │  - drm_kms_helper                                                                       │   │
│  │  - drm_dma_helper                                                                       │   │
│  │  - drm_display_helper                                                                   │   │
│  │  - drm_shmem_helper                                                                     │   │
│  │  - drm (Core)                                                                            │   │
│  │  - backlight                                                                             │   │
│  │  - cec                                                                                   │   │
│  │                                                                                          │   │
│  │  Problem: Viele Dependencies → lädt LANGSAM                                             │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ DRM → Hardware                                                    │
│                            ▼                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                            │
                            │
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  LAYER 4: HARDWARE LAYER                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  HDMI Output Hardware                                                                  │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Physical: HDMI Connector (Raspberry Pi 5)                                             │   │
│  │  Resolution: 1920x1080 @ 60Hz (Chromium) / 1280x400 (PeppyMeter)                      │   │
│  │  Display: External Monitor                                                             │   │
│  │  Rotation: Left (Landscape)                                                            │   │
│  │  Status: ✅ Hardware funktioniert                                                      │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🎵 AUDIO CHAIN (KOMPLETT & DETAILLIERT)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    AUDIO PIPELINE                                            │
│                          Vom Source bis zu den Lautsprechern                                 │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  LAYER 1: APPLICATION LAYER                                                                 │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  moOde Audio Player                                                                    │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Web UI: http://localhost/                                                             │   │
│  │  Status: ✅ Funktioniert                                                               │   │
│  │                                                                                          │   │
│  │  Audio Sources:                                                                         │   │
│  │  - Local Files (MP3, FLAC, etc.)                                                        │   │
│  │  - Web Radio Streams                                                                    │   │
│  │  - Spotify Connect                                                                      │   │
│  │  - AirPlay                                                                              │   │
│  │  - Bluetooth                                                                            │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ MPD Protocol                                                      │
│                            ▼                                                                  │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  MPD (Music Player Daemon)                                                             │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Process: mpd (PID: varies)                                                             │   │
│  │  Service: mpd.service                                                                   │   │
│  │  Config: /etc/mpd.conf                                                                  │   │
│  │  Status: ✅ Funktioniert                                                               │   │
│  │                                                                                          │   │
│  │  Audio Output Configuration:                                                            │   │
│  │  - Type: ALSA                                                                            │   │
│  │  - Device: hw:0,0 (HiFiBerry AMP100)                                                    │   │
│  │  - Format: 32-bit, 44100 Hz, Stereo                                                     │   │
│  │  - Mixer: Software                                                                      │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ ALSA API                                                         │
│                            ▼                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                            │
                            │
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  LAYER 2: ALSA LAYER                                                                         │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  ALSA Sound System                                                                      │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Library: libasound2                                                                    │   │
│  │  Config: /etc/asound.conf (systemweit)                                                  │   │
│  │  Config: ~/.asoundrc (user-spezifisch)                                                  │   │
│  │  Device: hw:0,0 (HiFiBerry AMP100)                                                      │   │
│  │  Status: ✅ Funktioniert                                                               │   │
│  │                                                                                          │   │
│  │  ALSA Utilities:                                                                        │   │
│  │  - aplay (Playback)                                                                     │   │
│  │  - arecord (Recording)                                                                  │   │
│  │  - alsamixer (Mixer Control)                                                            │   │
│  │  - amixer (Command-line Mixer)                                                          │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ ALSA → Kernel                                                    │
│                            ▼                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                            │
                            │
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  LAYER 3: KERNEL DRIVER LAYER                                                                │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  ALSA Kernel Driver                                                                     │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Kernel Modules:                                                                         │   │
│  │  - snd_soc_hifiberry_dacplus (HiFiBerry Driver)                                         │   │
│  │  - snd_soc_pcm512x (PCM5122 Codec Driver)                                               │   │
│  │  - snd_soc_pcm512x_i2c (PCM5122 I2C Driver)                                             │   │
│  │  - snd_soc_core (SoC Audio Core)                                                        │   │
│  │  - snd_pcm (PCM Interface)                                                              │   │
│  │  - snd (ALSA Core)                                                                      │   │
│  │                                                                                          │   │
│  │  Device: /dev/snd/pcmC0D0p (Playback)                                                   │   │
│  │  Format: I2S (Inter-IC Sound)                                                            │   │
│  │  Status: ✅ Funktioniert                                                               │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ I2S Protocol                                                     │
│                            ▼                                                                  │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  I2S Controller                                                                         │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Kernel: i2s_clk_consumer                                                              │   │
│  │  Overlay: hifiberry-amp100-pi5-dsp-reset                                                │   │
│  │  GPIO Pins:                                                                             │   │
│  │  - BCLK (Bit Clock)                                                                     │   │
│  │  - LRCLK (Left/Right Clock)                                                             │   │
│  │  - DATA (Audio Data)                                                                    │   │
│  │  Status: ✅ Funktioniert                                                               │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ I2S → Hardware                                                    │
│                            ▼                                                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                            │
                            │
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  LAYER 4: HARDWARE LAYER                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  HiFiBerry AMP100 Hardware                                                             │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  DAC: PCM5122 (Texas Instruments)                                                       │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  I2C Address: 0x4d                                                                      │   │
│  │  I2C Bus: 13 (RP1 Controller)                                                          │   │
│  │  Reset: GPIO 17 (via DSP Add-on) - ACTIVE LOW                                          │   │
│  │  Mute: GPIO 4 (via DSP Add-on) - HIGH = muted                                          │   │
│  │  Status: ✅ Funktioniert (nach Reset-Service)                                          │   │
│  │                                                                                          │   │
│  │  Reset-Sequenz (via dsp-reset-amp100.service):                                         │   │
│  │  1. GPIO 4 (Mute) → HIGH (muted)                                                        │   │
│  │  2. GPIO 17 (Reset) → LOW (reset)                                                       │   │
│  │  3. Wait 100ms                                                                          │   │
│  │  4. GPIO 17 (Reset) → HIGH (normal)                                                     │   │
│  │  5. GPIO 4 (Mute) → LOW (unmuted)                                                       │   │
│  │                                                                                          │   │
│  │  Audio Processing:                                                                      │   │
│  │  - Digital Audio (I2S) → PCM5122 DAC                                                    │   │
│  │  - Digital → Analog Conversion                                                          │   │
│  │  - Analog Signal → Class-D Amplifier                                                    │   │
│  │  - Amplified Signal → Speaker Terminals                                                │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            │ Analog Audio Signal                                              │
│                            ▼                                                                  │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  Speakers (Bose Wave Radio)                                                            │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Physical: Speaker Terminals (HiFiBerry AMP100)                                        │   │
│  │  Output: Analog Audio Signal                                                            │   │
│  │  Status: ✅ Funktioniert                                                               │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🔌 I2C BUS ARCHITEKTUR (DETAILLIERT)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                         I2C BUS ARCHITEKTUR - RASPBERRY PI 5                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  RASPBERRY PI 5 - I2C BUS MAPPING                                                            │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  I2C Bus 1 (Standard I2C)                                                               │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Device: /dev/i2c-1                                                                     │   │
│  │  GPIO: 2/3 (SDA/SCL)                                                                    │   │
│  │  Controller: Standard I2C Controller                                                   │   │
│  │  Status: ✅ Verfügbar                                                                  │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  I2C Bus 13 (RP1 Controller) ⭐ HAUPTBUS                                               │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Device: /dev/i2c-13                                                                    │   │
│  │  Path: /axi/pcie@1000120000/rp1/i2c@74000                                             │   │
│  │  GPIO: 2/3 (SDA/SCL) - via RP1                                                          │   │
│  │  Controller: RP1 I2C Controller                                                         │   │
│  │  Status: ✅ Aktiv                                                                      │   │
│  │                                                                                          │   │
│  │  ┌───────────────────────────────────────────────────────────────────────────────┐   │   │
│  │  │  I2C Devices auf Bus 13                                                         │   │   │
│  │  │  ──────────────────────────────────────────────────────────────────────────── │   │   │
│  │  │                                                                                 │   │   │
│  │  │  ┌──────────────────────────────┐  ┌──────────────────────────────┐          │   │   │
│  │  │  │  FT6236 Touchscreen          │  │  PCM5122 DAC (AMP100)        │          │   │   │
│  │  │  │  ─────────────────────────── │  │  ─────────────────────────── │          │   │   │
│  │  │  │  Address: 0x38               │  │  Address: 0x4d               │          │   │   │
│  │  │  │  Function: Touch Input       │  │  Function: Audio DAC         │          │   │   │
│  │  │  │  GPIO: 2/3 (SDA/SCL)         │  │  GPIO: 2/3 (SDA/SCL)         │          │   │   │
│  │  │  │  Status: ⚠️  Timing-Problem │  │  Status: ✅ OK                │          │   │   │
│  │  │  │                              │  │                              │          │   │   │
│  │  │  │  Problem:                    │  │  Reset:                      │          │   │   │
│  │  │  │  - Initialisiert VOR Display │  │  - GPIO 17 (via DSP Add-on)  │          │   │   │
│  │  │  │  - Blockiert I2C Bus 13      │  │  - dsp-reset-amp100.service  │          │   │   │
│  │  │  │  - X Server crasht           │  │  - Vor Driver-Load           │          │   │   │
│  │  │  │                              │  │                              │          │   │   │
│  │  │  │  Lösung:                     │  │  Mute:                       │          │   │   │
│  │  │  │  - systemd-Path-Unit          │  │  - GPIO 4 (via DSP Add-on)   │          │   │   │
│  │  │  │  - Warte auf /dev/dri/card0  │  │  - HIGH = muted              │          │   │   │
│  │  │  │  - Lade FT6236 NACH Display   │  │  - LOW = unmuted             │          │   │   │
│  │  │  └──────────────────────────────┘  └──────────────────────────────┘          │   │   │
│  │  │                                                                                 │   │   │
│  │  └───────────────────────────────────────────────────────────────────────────────┘   │   │
│  │                                                                                          │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  I2C Bus 14 (RP1 Controller - Alternative)                                             │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │  Device: /dev/i2c-14                                                                    │   │
│  │  Status: ✅ Verfügbar (nicht verwendet)                                                │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🔄 SYSTEM-INITIALISIERUNGS-REIHENFOLGE (DETAILLIERT)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                    SYSTEM BOOT & INITIALISIERUNG - KOMPLETT                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌──────────────┐
│   BOOT       │
│              │
│  Raspberry   │
│  Pi 5        │
│  Bootloader  │
│  (U-Boot)    │
└──────────────┘
        │
        │ Boot Sequence
        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 1: FIRMWARE BOOT                                                                      │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  1. Bootloader lädt config.txt                                                               │
│     ├─ vc4-kms-v3d-pi5,noaudio  (Display Overlay)                                           │
│     ├─ hifiberry-amp100-pi5-dsp-reset  (Audio Overlay)                                       │
│     └─ (ft6236 ENTFERNT)  ✅ (wird später geladen)                                           │
│                                                                                               │
│  2. Device Tree Overlays werden geladen                                                       │
│     ├─ Display Hardware wird erkannt                                                         │
│     ├─ Audio Hardware wird erkannt                                                          │
│     └─ I2C Bus 13 wird initialisiert                                                         │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
        │
        │ Kernel Boot
        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 2: KERNEL BOOT                                                                        │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  1. Kernel startet                                                                            │
│     ├─ Device Tree wird geladen                                                              │
│     ├─ Hardware wird erkannt                                                                 │
│     └─ I2C Bus 13 wird aktiviert                                                              │
│                                                                                               │
│  2. Kernel Module werden geladen (nach Dependencies)                                          │
│     ├─ vc4 (Display Driver)                                                                  │   │
│     │   └─ Dependencies: drm_kms_helper, drm_dma_helper, drm, ...                            │   │
│     │   └─ Status: ⚠️  Viele Dependencies → lädt LANGSAM                                      │   │
│     │                                                                                          │   │
│     ├─ snd_soc_pcm512x (Audio Driver)                                                         │   │
│     │   └─ Dependencies: snd_soc_core, snd_pcm, snd, ...                                     │   │
│     │   └─ Status: ✅ Funktioniert                                                          │   │
│     │                                                                                          │   │
│     └─ (ft6236 NICHT geladen)  ✅ (wird später geladen)                                       │   │
│                                                                                               │   │
│  3. Hardware wird initialisiert                                                               │   │
│     ├─ Display: /dev/dri/card0  ✅                                                             │   │
│     ├─ Audio: /dev/snd/pcmC0D0p  ✅                                                            │   │
│     └─ Touchscreen: (noch nicht)  ✅                                                           │   │
│                                                                                               │   │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
        │
        │ Systemd Start
        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  PHASE 3: SYSTEMD SERVICES                                                                   │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  1. dsp-reset-amp100.service  ✅                                                              │
│     └─ Reset AMP100 vor Driver-Load                                                          │
│        ├─ GPIO 4 (Mute) → HIGH                                                               │
│        ├─ GPIO 17 (Reset) → LOW                                                              │
│        ├─ Wait 100ms                                                                         │
│        ├─ GPIO 17 (Reset) → HIGH                                                             │
│        └─ GPIO 4 (Mute) → LOW                                                                │
│                                                                                               │
│  2. localdisplay.service  ✅                                                                  │
│     └─ Start X Server (Xorg :0)                                                              │
│        ├─ Display: HDMI-1                                                                     │
│        ├─ Rotation: Left                                                                     │
│        └─ Chromium: --kiosk http://localhost/                                                │
│                                                                                               │
│  3. display-ready.path  ⏳ (GEPLANT)                                                          │
│     └─ Warte auf /dev/dri/card0                                                              │
│        └─ Start ft6236-delay.service                                                          │
│           └─ modprobe ft6236                                                                  │
│                                                                                               │
│  4. mpd.service  ✅                                                                           │
│     └─ Music Player Daemon                                                                   │
│        └─ Audio Output: hw:0,0 (AMP100)                                                       │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## ⚠️ PROBLEM-BEREICHE (VISUALISIERT)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                         PROBLEM-BEREICHE - DETAILLIERT                                       │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  PROBLEM 1: FT6236 TIMING-KONFLIKT                                                           │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  ZEITLINIE: BOOT-SEQUENZ (AKTUELL - PROBLEMATISCH)                                      │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │                                                                                          │   │
│  │  T=0s    │  Bootloader startet                                                          │   │
│  │          │  ├─ vc4-kms-v3d-pi5 Overlay lädt                                            │   │
│  │          │  ├─ hifiberry-amp100 Overlay lädt                                           │   │
│  │          │  └─ ft6236 Overlay lädt  ❌ ZU FRÜH!                                         │   │
│  │          │                                                                              │   │
│  │  T=1s    │  Kernel Module laden                                                         │   │
│  │          │  ├─ ft6236 Modul lädt  ❌ ZU FRÜH! (wenige Dependencies)                    │   │
│  │          │  │   └─ I2C Bus 13 wird blockiert                                            │   │
│  │          │  └─ vc4 Modul lädt  ⏳ LANGSAM (viele Dependencies)                          │   │
│  │          │                                                                              │   │
│  │  T=2s    │  Hardware initialisieren                                                      │   │
│  │          │  ├─ FT6236 initialisiert  ❌ I2C Bus 13 blockiert                           │   │
│  │          │  └─ Display initialisiert  ❌ I2C Bus 13 benötigt (EDID)                     │   │
│  │          │     └─ KONFLIKT! → X Server crasht                                          │   │
│  │          │                                                                              │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  ZEITLINIE: BOOT-SEQUENZ (GEPLANT - MIT LÖSUNG)                                         │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │                                                                                          │   │
│  │  T=0s    │  Bootloader startet                                                          │   │
│  │          │  ├─ vc4-kms-v3d-pi5 Overlay lädt                                            │   │
│  │          │  ├─ hifiberry-amp100 Overlay lädt                                           │   │
│  │          │  └─ (ft6236 Overlay ENTFERNT)  ✅                                            │   │
│  │          │                                                                              │   │
│  │  T=1s    │  Kernel Module laden                                                         │   │
│  │          │  ├─ vc4 Modul lädt  ✅ (viele Dependencies)                                 │   │
│  │          │  └─ (ft6236 Modul NICHT geladen)  ✅                                         │   │
│  │          │                                                                              │   │
│  │  T=2s    │  Hardware initialisieren                                                      │   │
│  │          │  └─ Display initialisiert  ✅ I2C Bus 13 frei                                │   │
│  │          │     └─ /dev/dri/card0 wird erstellt                                          │   │
│  │          │                                                                              │   │
│  │  T=3s    │  systemd Services                                                             │   │
│  │          │  ├─ localdisplay.service startet  ✅                                          │   │
│  │          │  └─ display-ready.path erkennt /dev/dri/card0  ✅                           │   │
│  │          │     └─ Start ft6236-delay.service                                            │   │
│  │          │        └─ modprobe ft6236  ✅ NACH Display                                    │   │
│  │          │                                                                              │   │
│  │  T=4s    │  FT6236 initialisiert  ✅ I2C Bus 13 frei                                    │   │
│  │          │  └─ Touchscreen funktioniert                                                 │   │
│  │          │                                                                              │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  PROBLEM 2: AMP100 RESET-KONFLIKT                                                            │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  KONFLIKT: DEVICE TREE vs DSP ADD-ON                                                     │   │
│  │  ──────────────────────────────────────────────────────────────────────────────────── │   │
│  │                                                                                          │   │
│  │  ┌──────────────────────────────┐         ┌──────────────────────────────┐            │   │
│  │  │  Device Tree Overlay         │  ❌     │  DSP Add-on                  │            │   │
│  │  │  (hifiberry-amp100)          │  ────► │  (Hardware)                  │            │   │
│  │  │                              │  KONFLIKT │                              │            │   │
│  │  │  reset-gpio = <&gpio 17 0>   │         │  kontrolliert GPIO 17        │            │   │
│  │  │  mute-gpio = <&gpio 4 0>    │         │  kontrolliert GPIO 4          │            │   │
│  │  └──────────────────────────────┘         └──────────────────────────────┘            │   │
│  │                                                                                          │   │
│  │  LÖSUNG:                                                                                 │   │
│  │  ┌──────────────────────────────┐         ┌──────────────────────────────┐            │   │
│  │  │  Custom Overlay              │  ✅     │  DSP Add-on                  │            │   │
│  │  │  (ohne reset/mute-gpio)      │         │  (Hardware)                  │            │   │
│  │  │                              │         │                              │            │   │
│  │  │  Kein reset-gpio             │         │  kontrolliert GPIO 17        │            │   │
│  │  │  Kein mute-gpio              │         │  kontrolliert GPIO 4          │            │   │
│  │  └──────────────────────────────┘         └──────────────────────────────┘            │   │
│  │         │                                                                  │            │   │
│  │         │                                                       │            │            │   │
│  │         └───────────────────────────────────────────────────────┘            │            │   │
│  │                           systemd-Service                                      │            │   │
│  │                           (dsp-reset-amp100.service)                          │            │   │
│  │                           Reset vor Driver-Load                                │            │   │
│  │                                                                                          │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## ✅ LÖSUNGS-ARCHITEKTUR (VISUALISIERT)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                         LÖSUNGS-ARCHITEKTUR - ANSATZ A                                       │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  SYSTEMD-PATH-UNIT LÖSUNG                                                                    │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  Boot Sequence (mit Lösung):                                                                  │
│                                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  1. Device Tree Overlays laden                                                          │   │
│  │     ├─ vc4-kms-v3d-pi5,noaudio  ✅                                                     │   │
│  │     ├─ hifiberry-amp100-pi5-dsp-reset  ✅                                               │   │
│  │     └─ (ft6236 ENTFERNT aus config.txt)  ✅                                             │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            ▼                                                                  │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  2. Kernel Module laden                                                                 │   │
│  │     ├─ vc4 (Display)  ✅                                                                 │   │
│  │     └─ snd_soc_pcm512x (Audio)  ✅                                                       │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            ▼                                                                  │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  3. Hardware initialisieren                                                             │   │
│  │     ├─ Display: /dev/dri/card0  ✅                                                       │   │
│  │     └─ Audio: /dev/snd/pcmC0D0p  ✅                                                      │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                            │                                                                  │
│                            ▼                                                                  │
│  ┌───────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  4. systemd Services                                                                    │   │
│  │     ├─ dsp-reset-amp100.service  ✅                                                      │   │
│  │     │   └─ Reset AMP100 vor Driver-Load                                                 │   │
│  │     │                                                                                    │   │
│  │     ├─ localdisplay.service  ✅                                                          │   │
│  │     │   └─ Start X Server (Xorg :0)                                                     │   │
│  │     │                                                                                    │   │
│  │     └─ display-ready.path  ✅ (NEU!)                                                    │   │
│  │         └─ Warte auf /dev/dri/card0                                                      │   │
│  │            └─ Start ft6236-delay.service  ✅ (NEU!)                                      │   │
│  │               └─ modprobe ft6236  ✅ NACH Display                                        │   │
│  └───────────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                               │
│  Ergebnis:                                                                                    │
│  ✅ Display startet zuerst                                                                    │
│  ✅ FT6236 lädt NACH Display (Event-basiert)                                                 │
│  ✅ Keine Timing-Konflikte                                                                   │
│  ✅ Touchscreen funktioniert                                                                 │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 📊 STATUS-ÜBERSICHT (DETAILLIERT)

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                         SYSTEM STATUS - KOMPLETT                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  HARDWARE STATUS                                                                             │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  Raspberry Pi 5:        ✅ Online (2x: 192.168.178.62, 192.168.178.178)                      │
│  Display (HDMI):        ⚠️  Instabil (FT6236 Timing-Problem)                                 │
│  Touchscreen (FT6236):  ⚠️  Timing-Problem (initialisiert vor Display)                      │
│  Audio (AMP100):        ✅ Funktioniert (nach Reset-Service)                                 │
│  I2C Bus 13:            ⚠️  Konflikt (FT6236 vs Display)                                     │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  SOFTWARE STATUS                                                                             │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  OS:                    ✅ RaspiOS (Debian 13) / moOde Audio                                 │
│  X Server:              ⚠️  Instabil (FT6236 Timing-Problem)                                 │
│  Chromium:              ⚠️  Startet nicht zuverlässig                                        │
│  PeppyMeter:            ✅ Funktioniert (wenn X Server läuft)                                │
│  MPD:                   ✅ Funktioniert                                                      │
│  ALSA:                  ✅ Funktioniert                                                      │
│  systemd:               ✅ Funktioniert                                                      │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│  LÖSUNGS-STATUS                                                                              │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                               │
│  Ansatz A (Path-Unit):   ⏳ Ausstehend (geplant)                                             │
│  Ansatz C (Full Desktop): ⏳ Ausstehend (geplant)                                            │
│  Ansatz 1 (Service):      ⏳ Ausstehend (Backup)                                              │
│                                                                                               │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🔗 VERWANDTE DOKUMENTE

- [Hardware-Dokumentation](02_HARDWARE.md)
- [Probleme & Lösungen](03_PROBLEME_LOESUNGEN.md)
- [Ansätze & Vergleich](05_ANSATZE_VERGLEICH.md)
- [Test-Ergebnisse](04_TESTS_ERGEBNISSE.md)

---

**Letzte Aktualisierung:** 1. Dezember 2025  
**Version:** 1.0 - Detailliertes grafisches Cockpit
